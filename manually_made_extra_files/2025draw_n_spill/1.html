<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UTMCCF真心话大抽卡</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Color+Emoji');

        :root {
            --primary-color: #ff6b81;
            --secondary-color: #ff4757;
            --background-color: #1e1e1e;
            --card-background: #2d2d2d;
            --card-secondary-color: #ff4757;
            --card-primary-color: #ff6b81;

            --text-color: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.5);
            --glow-color: rgba(255, 71, 87, 0.8);
            --colorful-glitch-gradient: conic-gradient(
                from 0deg,
                #ff0000 0%, #00ffff 14%, #ff0000 28%, #ff0000 42%, 
                #ff0000 56%, #00ffff 70%, #00ffff 84%, #00ffff 100%
            );
            /* New variable for a distinct glitch color */
            --glitch-accent-color: cyan; /* A common digital artifact color */
        }


        body {
            font-family: 'Noto Color Emoji', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            /* Add a subtle animation to the body for an overall "digital disturbance" */
            animation: background-flicker 10s infinite alternate;
        }

        @keyframes background-flicker {
            0% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(2deg); }
            100% { filter: hue-rotate(-2deg); }
        }

        .container {
            text-align: center;
        }

        h1 {
            font-size: 3rem;
            color: var(--primary-color);
            text-shadow: 0 0 10px var(--glow-color), 0 0 20px var(--glow-color);
            margin-bottom: 2rem;
        }

        .card-container {
            position: relative;
            width: 300px;
            height: 400px;
            margin: 2rem auto;
        }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 20px;
            box-shadow: 0 10px 30px var(--shadow-color);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            font-size: 1.5rem;
            text-align: center;
            transition: opacity 0.5s ease-out; /* Make opacity change snappier */
        }

        .card-front {
            background: linear-gradient(135deg, var(--card-primary-color), var(--card-secondary-color));
            opacity: 0; /* Hide front card initially */
            z-index: 10;
            overflow: hidden; /* Crucial for clip-path to work well without showing overflow */
        }

        .card-back {
            background: var(--card-background);
            border: 2px solid var(--card-primary-color);
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 0 0 10px var(--glow-color);
            z-index: 5;
        }
        
        /* --- START: Glitch Animation Integration (Video Game Style) --- */

        .card-container.glitching .card-front {
            animation: video-game-glitch-main 0.5s forwards; /* Faster main glitch */
            position: relative; 
            opacity: 1; /* Ensure it's visible during glitch */
        }

        .card-container.glitching .card-front::before,
        .card-container.glitching .card-front::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--colorful-glitch-gradient); 
            border-radius: 20px;
            opacity: 0.8; /* Slightly more opaque */
            mix-blend-mode: hard-light; /* A more aggressive blend mode */
            pointer-events: none; 
            z-index: 100; /* Ensure glitch layers are on top */
        }

        .card-container.glitching .card-front::before {
            background: var(--glitch-accent-color); /* Use accent color for one layer */
            mix-blend-mode: screen; /* Different blend mode for more variation */
            animation: video-game-glitch-layer-1 0.8s forwards; /* Faster */
        }

        .card-container.glitching .card-front::after {
            background: var(--colorful-glitch-gradient); /* Keep gradient for the other */
            animation: video-game-glitch-layer-2 0.8s forwards; /* Faster */
        }

        @keyframes video-game-glitch-main {
            0% { transform: translate(0px, 0px) scale(1.0); opacity: 0; }
            5% { transform: translate(-3px, 3px) scale(1.02); opacity: 1; }
            10% { transform: translate(5px, -5px) scale(0.98); filter: hue-rotate(20deg); }
            15% { transform: translate(-7px, 7px) scale(1.03); opacity: 0.9; }
            20% { transform: translate(0px, 0px) scale(1.0); filter: hue-rotate(0deg); }
            25% { transform: translate(-10px, -2px) skewX(10deg); opacity: 0.8; }
            30% { transform: translate(12px, 5px) skewX(-10deg); filter: contrast(1.5); }
            35% { transform: translate(-8px, -8px) skewY(5deg); }
            40% { transform: translate(0px, 0px) skew(0deg) scale(1.0); filter: contrast(1); }
            42% { clip-path: polygon(0 20%, 100% 20%, 100% 80%, 0 80%); transform: scaleY(1.1); }
            44% { clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%); transform: scaleY(1); }
            50% { transform: translate(-15px, 0px) scaleX(0.9); opacity: 0.7; }
            55% { transform: translate(15px, 0px) scaleX(1.1); filter: saturate(2); }
            60% { transform: translate(-5px, 5px); }
            65% { transform: translate(5px, -5px); }
            70% { transform: translate(-2px, -2px); }
            75% { transform: translate(2px, 2px); }
            80% { transform: translate(0); scale(1); filter: saturate(1); }
            100% { transform: translate(0); opacity: 1; }
        }
        
        @keyframes video-game-glitch-layer-1 {
            0% { 
                clip-path: polygon(0 2%, 100% 2%, 100% 4%, 0 4%); /* Less tall rectangle start */
                opacity: 1; transform: translateX(0px); 
            }
            15% { transform: translateX(-15px); }
            30% { 
                clip-path: polygon(0 30%, 100% 30%, 100% 35%, 0 35%); 
                transform: translateX(10px);
            }
            45% { transform: translateX(-5px); }
            60% { 
                clip-path: polygon(0 60%, 100% 60%, 100% 63%, 0 63%); /* Less tall rectangle mid */
                transform: translateX(0px);
            }
            75% { transform: translateX(5px); }
            100% { clip-path: polygon(0 70%, 100% 70%, 100% 75%, 0 75%); opacity: 0; }
        }
        
        @keyframes video-game-glitch-layer-2 {
            0% { 
                clip-path: polygon(0 80%, 100% 80%, 100% 82%, 0 82%); /* Less tall rectangle start */
                opacity: 1; transform: translateX(0px);
            }
            20% { transform: translateX(10px); }
            40% { 
                clip-path: polygon(0 15%, 100% 15%, 100% 18%, 0 18%); 
                transform: translateX(-10px);
            }
            60% { transform: translateX(5px); }
            80% { 
                clip-path: polygon(0 40%, 100% 40%, 100% 43%, 0 43%); /* Less tall rectangle mid */
                transform: translateX(0px);
            }
            100% { clip-path: polygon(0 30%, 100% 30%, 100% 35%, 0 35%); opacity: 0; }
        }

        /* --- END: Glitch Animation Integration (Video Game Style) --- */

        #next-card-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-color);
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px var(--shadow-color);
        }

        #next-card-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--glow-color);
        }

        #next-card-btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Toggle button styles */
        .toggle-label {
            display: inline-block;
            position: relative;
            width: 60px;
            height: 30px;
        }

        .toggle-label input {
            display: none;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--secondary-color);
            border-radius: 30px;
            transition: background-color 0.3s;
        }

        .toggle-slider::before {
            content: "";
            position: absolute;
            height: 24px;
            width: 24px;
            left: 3px;
            bottom: 3px;
            background-color: #222;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }

        input:checked + .toggle-slider::before {
            transform: translateX(30px);
        }

        .mode-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            gap: 10px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>真心话<s>大冒险</s></h1>
        
        <!-- Add a mode toggle -->
        <div class="mode-toggle">
            <label for="mode-toggle" class="toggle-label">
                <input type="checkbox" id="mode-toggle">
                <span class="toggle-slider"></span>
            </label>
            <span id="mode-label">😁</span>
        </div>

        <div class="card-container" id="card-container">
            <div class="card card-back" id="card-back">
                ?
            </div>
            <div class="card card-front" id="card-content">
                点击“下一张卡”开始游戏
            </div>
        </div>
        <button id="next-card-btn">下一张卡</button>
    </div>

    <script>
        let use_utility = (new Date() > new Date("2025-10-24T18:25:00-04:00")) ? 1 : 1;
        let hard_mode_utility_card_probability = 0.25*use_utility; // 30% chance to draw a utility card in hard mode
        let easy_mode_utility_card_probability = 0.5*use_utility; // 10% chance to draw a utility card in easy mode

        const easy = `
你最喜欢和讨厌的学科是什么？
在工作学习之余，你对什么事情充满热情？
你最喜欢的电影/书是什么？
你喜欢小孩吗？希望拥有子女吗？为什么？
如果退休了，你希望拥有什么爱好？
小时候你最害怕什么？长大后你最害怕什么？
小时候的你希望长大后做什么？
有哪些事情，你一直想做，但是还没有做？为什么？
你向往的生活是什么样的？
你认为什么样的人最有影响力？他/她会具备哪些品格？
你想因什么事出名/被认识？
你欣赏的人有什么样的特质？
你觉得融入群体有压力吗？为什么？
你觉得什么样的人生是活得有价值的？为什么？
你认为人生中最快乐的事情是什么？
你觉得真正的自由是什么？你最想在哪方面自由？
你的性格偏向于保守型/变革型？如果保守，在哪些方面？如果变革，最想改变什么？
你如何看待周围的罪恶？（世界、国家、城市、公司、学校……）
你养过宠物吗？如果有，它是什么样的？如果没有，你想养什么宠物？为什么？
你尝试过祈祷吗？如果有，那是怎样经历？发生了什么？
如果有一位上帝，能回答你的各种问题，你会问他什么？
如果过去的你穿越到现在，他/她会怎么看待现在的自己？
如果你有能力解决一个世界/生活上最大的问题，你会解决什么？
如果你要为自己写墓志铭/遗嘱，你会写下什么？
你想要有什么超级能力？为什么？
如果你能和任何人交换一天，你会选择谁？为什么？
如果你能把任何事情作为你的事业，你会做什么？
如果不考虑经济问题，你想长生不老吗？为什么？
如果你能见任何明星/历史人物，你想见谁？为什么？
你必须和一位圣经人物一起被困在电梯里24小时，你最不希望是谁？
你必须用一种动物的叫声来代替你的笑声，你会选哪种动物？
你认为哪种食物最能代表你的性格？
你必须放弃使用一种餐具（筷子、勺子、叉子）一辈子，你放弃哪个？ 
你觉得外星人看地球人最奇怪的习惯是什么？
如果你能瞬间变成任何年龄（一至一百岁），你会选几岁？为什么？
如果你要开一家完全没用的公司，它会卖什么？
你祷告或读圣经的时候，最容易被什么东西分心？
你在学校里最奇怪的“睡着（或差点睡着）”的地方是哪里？
你为了拖延一个大作业，做过最荒谬的事或买过最奇怪的东西是什么？
你在校园里拿过最棒的免费赠品（像T-shirt、水瓶之类）是什么？
你选课的首要标准是什么？（比如：不用早起、prof 好、没有final、课程听起来有趣等等）
你有没有什么奇怪的食物组合你其实很爱吃，但别人会觉得怪？
如果你每天多一个小时（不能用来睡觉、上课或工作），你会拿来做什么？
有没有一句所谓的“人生鸡汤”或“励志名言”，你其实觉得很烦或没什么用？
「我觉得在这个房间里，只有我______。」
别人还没认识你前，最常对你有什么误解？
解释你的微信名和头像！
如果你可以“静音”掉一个来自世界、家人、或自己给的期望，会是哪一个？
哪一个虚构反派角色你觉得其实蛮有道理的？
你觉得祷告改变世界还是改变人？
你最想让别人知道“信耶稣”其实不是____？
“虽然对大多数人来说很惊讶，天国其实____”
“虽然对大多数人来说很惊讶，但信耶稣其实____”
如果你必须选一个团契成员一起被困在荒岛，你会选谁？为什么？
你最怕哪一种“属灵人设”？
你在教会或团契里遇过最尴尬的瞬间？
你最想问神一句大胆的问题是什么？
你听过团契最奇怪的祷告内容是什么？
如果撒旦今天给你一个诱惑，你觉得最可能让你“上钩”的是什么？（比如：完美的GPA、巨额财富、爱情...）
你手机的搜索历史记录里，最近一个让你觉得“被别人看到会很奇怪”的搜索是什么？
你做过的最让你的室友（或家人）无语或抓狂的一件事是什么？
你发过最想删除的社交媒体贴文是哪一条？
你最离谱的一次网购冲动是什么？
你人生中最勇敢的一个决定是什么？
你觉得幸福的反义词是什么？
你有没有在课堂或会议上睡着过？被发现了吗？
你买过的东西里，最后悔、最“智商税”的一件是什么？
你上次对父母（或家人）撒谎是什么时候？撒了什么谎？
你拖延作业最“创意”的方式是什么？
你上课最严重的分心行为是什么？
你在校园里经历过最诡异或好笑的事件是什么？
你遇到过最传奇的prof是谁？
如果耶稣今天在你宿舍门口敲门，你会先藏什么？
你被人认错的最夸张经历？
有什么你小时候以为是大人发明来骗小孩的事？
你曾经最荒唐的一次消费是什么？
你讲过最失败的笑话？
你最常做但从没成功的“健康计划”？
你被教授气到的瞬间？
你最无意义的通宵？
你最喜欢的一句与最反感的一句“励志名言”？
你印象中最奇怪的中国/外国文化差异是什么？
计时30秒，连续夸上一个玩家，不得间断
        `;
        const hard = `
最近你的祷告生活如何？你在为哪些事项祷告？
最近的主日讲道或小组学习中，神的话对你有什么新的提醒、责备或鼓励？
最近你有操练在教会或团契中学到的东西吗？如果有，可以分享一个例子吗？如果没有，可以分享你的挑战吗？
你是如何成为一个基督徒的？
你信主以后最大的改变是什么？
分享一个你经历到神祝福的事情。
在学习中，你有什么经历神同在的事？其中有什么感恩或挑战？
最近你有什么感恩的事？
你喜欢目前的生活吗？为什么？
你会为哪些事情忧虑？当你忧虑的时候会怎么办？
最近你遇到了哪些困境？它如何影响你对神的信心？
什么类型的人、情况或事情最容易刺激或激怒你？你通常如何处理这些情绪？
在工作或学习中，你最喜欢和最不喜欢的事情是什么？
在工作或学习中，你最大的挑战或挣扎是什么？我们可以如何为你祷告？
和家人相处中，你最大的挑战或挣扎是什么？我们可以如何为你祷告？
你一般如何面对冲突？
你最近一次感到孤独是什么时候？原因是什么？
你最近一次认识到自己的罪是什么时候？
最近你在尝试用什么方式服侍教会/他人？
你心中的偶像是什么？（什么在与你争夺神在你生命中的主权？）
你如何看待传福音？在传福音方面你的挑战是什么？
过一个“舍己”的生活对你来说意味着什么？这会如何影响你的生活、工作、人际关系、时间管理和金钱？
有什么经历改变了你看待世界的方式？
谁是对你一生影响最大的人？
你最欣赏他人身上的哪种价值？
有什么是你希望别人能理解你的地方？
什么事情总能让你感到敬畏或平静？
你在什么时候感到最有生命力？
当事情无法理解时，你如何找到内心的平静？
当生活失去掌控时，你会怎么做？
是什么让你的生命有意义或目标？
当生活变得艰难时，你从哪里找到希望？
什么让一个社群让你感到安全？
你曾在哪个地方感到被真正认识和接纳？是什么让那成为可能的？
是什么最影响了你的信仰（或怀疑）？
你是否曾在某件重要的事上改变过想法？是什么促成的？
什么样的证据或经历会让你相信（或质疑）上帝的存在？
当你做决定时，如何在感觉与理智之间取得平衡？
信仰与科学能共存吗？为什么或为什么不能？
对你来说，过一个好生活意味着什么？
你如何判断什么是对或错？
宽恕总是可能的吗？为什么或为什么不？
在你看来，爱（超越浪漫）是什么样子的？
哪个故事（来自你的生活、书籍、电影或经文）最激励你？
你的个人故事如何影响你看待世界的方式？
你有完全搞不懂的圣经人物（或者历史人物）吗？
What is a non-Christian song you listen to that has surprisingly good spiritual themes?
小时候你百分百相信的事，现在才发现完全错了的是什么？
一个对UTMCCF团契的吐槽！
一个对UTMCCF团契的意见/建议！
解释你的微信名和头像！
你有没有一个“想原谅但还做不到”的人或事？
你怎么看“原谅”和“忘记”的差别？
你觉得“成长”最痛的部分？
你觉得祷告改变世界还是改变人？
你最想挑战的一个社会标签？
如果你可以把一节经文用记号笔写在别人身上，会选哪节？
有没有一次你被人误解到想消失？
你第一次觉得“我真的被理解了”的时刻？
如果上帝今天亲口问你一个问题，你最怕祂问什么？
你最后一次流泪是什么时候？为什么？
有没有哪节经文让你觉得“被打脸”？
你现在最难相信的圣经应许是哪一个？
你有没有哪个问题问上帝很久都没答案？
你害怕变成怎样的人？
你最害怕上帝要你放下什么？
你觉得信仰中最“反直觉”的真理是什么？
你曾经把信仰当成压力吗？
____曾让我感觉就像与基督的爱隔离了。
你曾经怀疑上帝真的爱你吗？
你信主以来最大的“aha moment”？
你最想让别人知道“信耶稣”其实不是____？
你最难接受的上帝属性是哪一个？
假设天堂也有UTMCCF，你觉得活动会是什么样的？
有哪次你表现得“很自信”，其实心里超慌？
你最想改变自己性格里的哪一点？
有没有一件别人很羡慕、但你其实不喜欢的事？
有没有一次你觉得「信仰群体」比「信仰」更让你疲惫？
当你祷告「主啊，求你赐下合一」时，你内心其实希望谁先改变？
「基督打破了隔墙」——那你心里现在最不想被打破的隔墙是什么？
觉得上帝有没有在你的生命里打破过某种隔阂？（比如语言、文化、性格、防备心、身份的差异）
你觉得「和睦」跟「假装没事」之间的界线在哪里？
你是否有曾经在哪个时刻，在团契/教会感受到「这就是家」？
当有人说「我们是一家人」，你脑中浮现的画面是什么？（温馨晚餐、家庭争吵、群组已读不回… ）
你是谁？如果不能提“专业”和“成就”，你会怎么介绍自己？
你觉得“上帝怎么看你”这句话，对你来说是安慰还是压力？
如果“在基督里合一”不是“大家都一样”，那它到底是什么？
你觉得现代生活中最容易“取代”上帝的位置的东西是什么？
你有没有某一刻觉得社交媒体让你更远离上帝？
如果“安息”是一门选修课，你觉得你会过吗？
当你做错事后，你更容易“躲上帝”还是“找上帝”？
当你不在学习、不在表现、不在服事时，你是谁？
有没有哪个标签（性格、文化、学业）让你觉得被束缚？
你觉得“成长”更像是一种增加、还是一种被剥去？
你比较容易原谅别人还是原谅自己？
你有没有被别人的接纳惊到过？
你有没有在团契/教会里感受到“比较”或“标准”带来的压力过？
你觉得信仰改变了你哪些价值观？
你最想变成一个怎样的基督徒？
当有人和你观点完全不一样时，你会怎么做？
你有没有因为自己的信仰观点而被朋友吐槽过？
我们都喜欢跟“合得来”的人一起，但团契/教会常常是一些“完全不一样”的人组成的。你觉得这种“不一样”是负担还是礼物？
如果你带一个朋友来团契，你最怕他第一天看到什么情景？最希望他看到什么？
如果团契没有共同兴趣（比如不一起玩、不一起吃），它还能存在吗？
你更倾向祷告改变事情，别人，还是改变自己？
你觉得“在基督里的团契”最打破你以往社交观念的地方是什么？
        `;
        const easy_questions = easy.trim().split('\n');
        const hard_questions = hard.trim().split('\n');
        const easy_utility_cards = [
"😜加倍卡：哈哈哈哈~ 请再抽两张卡牌，并回答。",
"🔀反问卡：请再抽一张卡牌，可以任选一位玩家代替你作答。",
"👯陪伴卡：请再抽一张卡牌，可以任选一位玩家与你一起回答。",
"📢 群攻卡：请再抽一张卡牌，所有人都要作答",
"🐸 呱噪卡：请再抽一张卡牌，回答时须模仿青蛙，每句话呱一声。",
"🐒 动物卡：请再抽一张卡牌，回答时须模仿一种动物。",
"🤖 变声卡：请再抽一张卡牌，并用一种奇怪的声音作答。",
"😈指定卡：你可以指定一位玩家在下一轮用任何特效作答",
"🗣️第三人称卡：请再抽一张卡牌，回答时不能使用“我”，必须用自己的名字代替！",
"🐍 谎言卡：请再抽一张卡牌，回答时须混入一句谎话，让大家猜哪句是假的。猜错的人下一轮须用小猫的语气作答",
"👯陪伴卡：请再抽一张卡牌，可以任选一位玩家与你一起回答。",
"☝️手势卡：请再抽一张卡牌，答题时全程用夸张手势配合。",
"👋手语卡：请再抽一张卡牌，回答时由你左边的玩家进行手语翻译（或夸张比划）",
"👋手语卡：请再抽一张卡牌，回答时由你右边的玩家进行手语翻译（或夸张比划）",
        ];
        const hard_utility_cards = [
"😜加倍卡：哈哈哈哈~ 请再抽两张卡牌，并回答。",
"🔀反问卡：请再抽一张卡牌，可以任选一位玩家代替你作答。",
"👯陪伴卡：请再抽一张卡牌，可以任选一位玩家与你一起回答。",
"👯陪伴卡：请再抽一张卡牌，可以任选一位玩家与你一起回答。",
"📢 群攻卡：请再抽一张卡牌，所有人都要作答",
"😈指定卡：你可以指定一位玩家用任何特效回答出现过的任何问题",
        ];
        function setCardColorsForMode(isHardMode) {
            const root = document.documentElement;
            if (isHardMode) {
                root.style.setProperty('--card-primary-color', '#803d6f'); //  red
                root.style.setProperty('--card-secondary-color', '#150070'); // dark 
            } else {
                root.style.setProperty('--card-primary-color', '#ff4757'); // original
                root.style.setProperty('--card-secondary-color', '#ff6b81'); // original
            }
        }

        const cardContainer = document.getElementById('card-container');
        const cardContent = document.getElementById('card-content');
        const cardBack = document.getElementById('card-back');
        const nextCardBtn = document.getElementById('next-card-btn');
        const modeSlider = document.getElementById('mode-slider');
        const modeLabel = document.getElementById('mode-label');
        const modeToggle = document.getElementById('mode-toggle');

        let currentQuestions = [...easy_questions]; // Default to easy questions
        let isFirstClick = true;
        let lastCardType = "utility"; // Track the last card type ("question" or "utility")
        let utilityCardIndex = 0; // Track the current utility card index for round-robin
        let drawCount = 0; // count total draws; first 5 draws must be questions

        let pendingColorChange = null;

        modeToggle.addEventListener('change', () => {
            if (modeToggle.checked) {
                currentQuestions = [...hard_questions];
                modeLabel.textContent = "🤔";
                pendingColorChange = true; // Delay color change
            } else {
                currentQuestions = [...easy_questions];
                modeLabel.textContent = "😁";
                pendingColorChange = false; // Delay color change
            }
        });



        function getRandomQuestion() {
            if (currentQuestions.length === 0) {
                // Reset the questions based on the current mode
                currentQuestions = modeToggle.checked ? [...hard_questions] : [...easy_questions];
            }

            const randomIndex = Math.floor(Math.random() * currentQuestions.length);
            let question = currentQuestions.splice(randomIndex, 1)[0]; // Remove and return the question

            // If question contains '#', split and pick a random part
            if (question.includes("#")) {
                const parts = question.split("#").map(part => part.trim()).filter(Boolean);
                question = parts[Math.floor(Math.random() * parts.length)];
            } else {
                question = question.trim();
            }

            return question;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        let easyUtilityCardIndex = 0; // Track the current utility card index for easy mode
        let hardUtilityCardIndex = 0; // Track the current utility card index for hard mode

        function getUtilityCard() {
            const utilityCards = modeToggle.checked ? hard_utility_cards : easy_utility_cards; // Select the appropriate list
            let utilityCardIndex = modeToggle.checked ? hardUtilityCardIndex : easyUtilityCardIndex;

            if (utilityCardIndex === 0) {
                shuffleArray(utilityCards); // Shuffle the utility cards when starting a new round
            }

            const card = utilityCards[utilityCardIndex];
            utilityCardIndex = (utilityCardIndex + 1) % utilityCards.length; // Move to the next utility card

            // Update the correct index based on the mode
            if (modeToggle.checked) {
                hardUtilityCardIndex = utilityCardIndex;
            } else {
                easyUtilityCardIndex = utilityCardIndex;
            }

            return card;
        }

        function shouldDrawUtilityCard() {
            const probability = modeToggle.checked
                ? hard_mode_utility_card_probability
                : easy_mode_utility_card_probability;
            return Math.random() < probability;
        }

        nextCardBtn.addEventListener('click', () => {
            nextCardBtn.disabled = true;

            if (isFirstClick) {
                cardBack.style.opacity = '0';
                cardContent.style.opacity = '1';
                isFirstClick = false;
            }

            cardContainer.classList.remove('glitching');
            void cardContainer.offsetWidth;

            setTimeout(() => {
                let newCard;
                const withinFirstFive = drawCount < 3;

                if (withinFirstFive || lastCardType === "utility" || !shouldDrawUtilityCard()) {
                    newCard = getRandomQuestion();
                    lastCardType = "question";
                } else {
                    newCard = getUtilityCard();
                    lastCardType = "utility";
                }

                drawCount++;

                cardContent.textContent = newCard;
                cardContainer.classList.add('glitching');

                // Change color after draw if pending
                if (pendingColorChange !== null) {
                    setCardColorsForMode(pendingColorChange);
                    pendingColorChange = null;
                }

                setTimeout(() => {
                    nextCardBtn.disabled = false;
                }, 800);
            }, 50);
        });
    </script>

</body>
</html>