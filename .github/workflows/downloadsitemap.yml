name: Check sitemap and clone website

on:
  workflow_dispatch:
  push:
  schedule:
    - cron:  '*/20 8-23,0-2 * * *'
    #run every 20minutes, between 8AM to 23PM and also 0AM to 2AM
  
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: checkout repo 
        uses: actions/checkout@v3 # checkout the repository content

      - name: setup python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10' # install the python version needed
      - name: Install dependencies
        run: pip install pytz

      - name: download sitemap and split each tag into a new line 
        run: curl https://utmccf.wordpress.com/sitemap.xml | sed --expression='s/</\n</g' | tail -n +2 > clean_utmccf.wordpress.com/sitemap.xml
      - name: clone website and commit files if there are any differences
        run: |
          #if there is no difference, return 0 and stop 

          git add -A 
          git diff --quiet && git diff --staged --quiet && echo "ðŸ’¤ðŸ’¤ðŸ’¤NO CHANGEðŸ’¤ðŸ’¤ðŸ’¤" && exit 0 

          #if program did not stop:
          echo "ðŸ› ï¸ðŸ› ï¸ðŸ› ï¸change foundðŸ› ï¸ðŸ› ï¸ðŸ› ï¸"
          (python clonewebsite.py --downloadAgain) > clean_utmccf.wordpress.com/status.log 
          git add -A 
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action bot"
          git commit -am "Auto cloned website after finding change in sitemap.xml"
          git push
